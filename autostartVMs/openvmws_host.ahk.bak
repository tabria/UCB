#NoEnv
#SingleInstance force
#Include D:\Virtual Machines\SPODELEN\UCB\lib\Acc.ahk
#KeyHistory 0
CoordMode, Mouse, Screen
SetTitleMatchMode 2
SetKeyDelay, 50, 10
SetBatchLines, -1
SetControlDelay -1
ListLines, Off



;variables
vmarray:={"1":"rastylime", "2":"staho", "3":"adveto", "4":"dribov", "5":"bojo12", "6":"haribo", "7":"kirkir", "8":"tramada", "9":"craver", "10":"raverit", "11":"mim22", "12":"retpet", "13":"tuiti", "14":"cryon", "15":"proto", "16":"tambro", "17":"johobo", "18":"yoyo_mobo","19":"daba11"}

nextvm:="D:\Virtual Machines\SPODELEN\UCB\autostartVMs\startnextvm.txt"
vm1notopen=mgrushe
tabloc:="client1.window6.client1.window4.client1"
tabnomerloc:="client1.window6.client1.window4.client1.window.x"
waitTime:=15000

sleep 100

FileDelete, %nextvm%

sleep 100

WinActivate, ahk_class VMUIFrame
sleep 100
;proverka dali v tab ima otvoreni tabove s drugi vm
broitaboveObj:=Acc_Get("Object", tabloc, 0, "ahk_class VMUIFrame")
broitabove:=broitaboveObj .accChildCount
if (broitabove>19)
{
	goto, opentabs
}
if (broitabove<19)
{
	msgbox, Nqma Tabove
}
opentabs:
;izbira se tab 1
breaktab:=0
tabnomer:=0
Loop
{
	if (breaktab>=19)
	{
		;msgbox, break
		break
	}
	else
	{
		;msgbox, ok goo
		tabnomer:=tabnomer+1
		StringReplace, tabnomerlocReal, tabnomerloc, .x, %tabnomer%
		sleep 10
		tabname:=Acc_Get("Name", tabnomerlocReal, 0, "ahk_class VMUIFrame")
		sleep 10
		if (tabname!="") and (tabname!=vm1notopen)
		{
			breaktab:=breaktab+1
			xtab := Acc_GetX("location", tabnomerlocReal, 0, "ahk_class VMUIFrame")
			ytab := Acc_Gety("location", tabnomerlocReal, 0, "ahk_class VMUIFrame")
			xm:=xtab+30
			ym:=ytab+14
			sleep 300
			MouseMove, %xm%, %ym%, 2
			sleep 100
			MouseClick, left
			sleep 1000
			;startira virtualnata mashina
			send {Ctrl down}{b down}{b up}{ctrl up}
			sleep %waitTime%
		}
	}
}

;fail za podredba na vm pri connectvane kam inet-a
for numb, name in vmarray
{
	FileAppend, %name%, %nextvm%
	Loop
	{
		IfNotExist, %nextvm%
		{
			break
		}
		sleep 5000
	}
}

ExitApp
!^q::ExitApp
return
