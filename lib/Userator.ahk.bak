;========================================================================================
; Userator Class													           			;
;========================================================================================
	#NoEnv
	#Include Z:\SPODELEN\UCB\lib\Acc.ahk
	#Include Z:\SPODELEN\UCB\lib\trayIcon.ahk
	#Include Z:\SPODELEN\UCB\lib\Firefox.ahk
	#Include Z:\SPODELEN\UCB\lib\vlibrary.ahk
	#KeyHistory 0
	#MaxThreads 225
	#MaxMem 256
	ListLines, Off
	CoordMode, Mouse, Screen
	SetTitleMatchMode 2
	SetKeyDelay, 50, 10
	SetBatchLines, -1
	StringCaseSense, Locale
	
	
	Class Userator extends Firefox {
	
		no_task_path_Array	:="application.grouping1.property_page1.unknown_object1.document1.unknown_object3.unknown_object2.unknown_object1.unknown_object1.unknown_object1.editable_text1"
		task_type_Array		:="application.grouping1.property_page1.unknown_object1.document1.unknown_object3.unknown_object2.unknown_object1.unknown_object1.unknown_object1.unknown_object1.unknown_object1.editable_text1"
		Soft_Error_Array	:= "application.grouping1.property_page1.unknown_object1.document1.unknown_object1.editable_text1"
		nevtop50var			:= ""
		ExcludeSites	:=["reklama-rt16.ru", "concepto.ru", "artlogic-abc.ru", "ide-agency.ru", "rapart.ru", "tatneko.ru", "грунт-зона.рф", "vamproducts.ru", "kamin-keramik.ru", "a107prom.ru", "info-dom.ru", "sazhentsi.tiu.ru", "topxl.ru", "cashbuzz.ru", "mrt-rus.info", "diagnostikacentr.ru", "saratov.ldc.ru", "ooo-ip-spb.ru", "avito", "soft1", "softl", "проверь-печень.рф", "rezervkapital.ru", "wiseadvice", "serpstat", "blackkit", "skrill", "tourister", "openeyesdesign", "otzovyk", "lenadia", "aksioma", "youtube", "lrnd", "tapeten", "грунт-зона", "rospres", "усадьбаклязьма", "autosteklo", "svoimi", "kompromat", "klinkerhof", "nnprositutki", "sluh", "pechnik", "mzk", "сейфеддин"]
		posi:=0
		
		nozadnow:="Сейчас нет задания для Вашего IP"
		nozadcheck:="К сожалению, сейчас заданий для вашего IP нет"
		nozadnoweng:="Now there is no tasks for your IP"
	
	;Activating Userator and checking for existence
		useratorActivate() {
			WinActivate, ahk_class UseratorGUI
			sleep 200
		}
	;Check if Userator Exist
		useratorExistNew() {
			behave	:= "behavioral"
			t:=0
				
			Loop {
				IfWinExist, Counter Avtomat Izchakvane
				{
					sleep 60000
					continue
				}
				IfWinExist, ABBYY Screenshot Reader
				{
					;msgbox, abyy exist
					this.browserWinAction("abbyy", "close")
				}
				IfWinExist, Userator
				{
					;msgbox, user exist
					WinGetText, nozadtitle, Userator
					If InStr(nozadtitle, this.nozadnow) or InStr(nozadtitle, this.nozadnoweng) {
						;msgbox, nqma zad
						;msgbox, here
						WinActivate, Userator
						WinGetPos, x, y, , , Userator
						;msgbox, x %x%
						this.OffsetLMouseClick(x, y, 183, 82)
						sleep 1000
						continue
					}
					this.useratorNotOnTop()
				}
				WinGetPos, x, y, width, height, ahk_class UseratorGUI
				;msgbox, height %height%
				if (height="") or (height=768) {
					;nqma userator
					t:=t+1
					if (t>100) {
						;ask for new task Userator
						this.UseratorNovoZadanie()
						Run, Z:\SPODELEN\UCB\vstart.ahk
						ExitApp
					}
					sleep 1579
					continue
				} else {
					;ima userator
				;msgbox, ima userator
					this.useratorNotOnTop()
					break
				}
			}
			sleep 100
			;msgbox, exit userExistnew
			return	
		}
	;Proverka userator za greshki
		useratorErrornew() {
			greshkawidthConn:=521
			greshkaheightConn:=138
			greshkawidthcheck:=598
			greshkaheightcheck:=121
			nqmazadaniqwidth:=389
			nqmazadaniqheight:=113
			
			WinGetPos, x, y, width, height, ahk_class UseratorGUI
			if ((width=greshkawidthcheck) and (height=greshkaheightcheck)) or ((width=greshkawidthConn) and (height=greshkaheightConn)) {
				;greshka ot sarvara, izprashta se ctrl+1 i se otvarq nov start script
				this.useratorNovoZadanie()
				Run, Z:\SPODELEN\UCB\vstart.ahk
				ExitApp
				;this.messagebox("Error")
				;this.useratorActivate() ;this.Cr1user();this.useratorExistnew()
			}
			sleep 100
			return	
		}
	;Open new task from userator program
		useratorNovoZadanie() {
			t:=0
			Loop {
				sleep 200
				MouseMove, 1136, 430, 2
				sleep 100
				TrayIcon_Button("userator.exe", "R")
				sleep 100
				Loop, 3 {
					this.Dow()
					sleep 150
				}
				this.Ente()
				Loop {
					MouseClick, left, 1168, 10, 1, 3
					sleep 100
					WinGetActiveStats, title, width, height, x, y
					IfWinExist, Userator
					{
						WinGetText, nozadtitle, Userator
						StringCaseSense, Locale
						If InStr(nozadtitle, this.nozadnow) or InStr(nozadtitle, this.nozadnoweng)
						{
							this.useratorActivate()
							WinGetPos, x, y,,Userator
							this.OffsetLMouseClick(x, y, 183, 82)
							sleep 300
							;sleep 177328
							break 2
						}	
					}
					if (height=768) {
						t:=t+1
						if (t>100) {
							t:=0
							sleep 10
							goto, looppakcheck
						}
						sleep 1753
						goto, useratornotexistnew1212
					} else {
						;ima userator
						break 2
					}
					useratornotexistnew1212:
					sleep 10
				}
				looppakcheck:
				sleep 10
			}
			sleep 100
			return
		}
	;Make Userator program not to be on TOp	
		useratorNotOnTop() {
			this.useratorActivate()
			WinSet, AlwaysOnTop, Off, ahk_class UseratorGUI
			sleep 100
			return
		}
	;Send Ctrl+1 in userator and make checks
		useratorCtrl1() {
			WinGetPos, x, y, width, height, ahk_class UseratorGUI
			widthstart:=width
			heightstart:=height	
			Loop {
				;this.browserWinAction("Firefox", "activate")
				this.useratorActivate()
				this.Cr1user()
				;loop for checking if userator is open and if the dimentions are correct
				Loop {
					this.UseratorExistnew()
					this.UseratorErrornew()
					WinGetPos, x, y, width, height, ahk_class UseratorGUI
					widthend:=width
					heightend:=height
					;check the dimentions
					;msgbox, withend %widthend%
					if (widthstart=widthend) and (heightstart=heightend) {
						;sravnqvanite razmeri sa ednakvi => nqmame promqna
						;msgbox, ednakvi
						sleep 1
						continue 2
					} else {
						;sravnqvanite razmeri sa razlichni => ima promqna
						;msgbox, izliza se ot loopa
						break 2
					}
				}
			}
			this.useratorNotOnTop()
			sleep 200
			return
		}
	;funkciq obedinqvashta screenshot-a i proverkite
		useratorScreenPlusErrors() {
			this.useratorScreenshot()
			this.useratorExistnew()
			this.useratorErrornew()
			sleep 200
			return
		}
	;making screenshot
		useratorScreenshot() {
			UserTitleCatcher=ScreenСatcher
			Loop
			{
				this.useratorActivate()
				sleep 50
				run, "Z:\SPODELEN\UCB\lib\AutoIT\enter.au3"
				sleep 200
				Loop, 100
				{
					;proverka dali userator sashtestvuva
					;this.useratorActivate()
					MouseClick, left, 1295, 10, 1, 3
					sleep 50
					WinGetActiveStats, title, width, height, x, y
					if (height=768) {
						;nqma userator
						;proverka dali tilte e screencatcher
						useratornamevalue1 := Acc_Get("Name", this.uListbox, 0, "ahk_class UseratorGUI")
						if (useratornamevalue1=UserTitleCatcher) {
							goto, exitmainloopUserSnimkiSS
						}
						goto, UseratorExistLoop1SS
					} else {
						;ima userator
						goto, UseratorExistLoop1SS
					}
					UseratorExistLoop1SS:
					sleep 10
				}
				sleep 1
			}
			exitmainloopUserSnimkiSS:
			Loop
			{
				this.useratorActivate()
				run, "Z:\SPODELEN\UCB\lib\AutoIT\enter.au3"
				sleep 200
				Loop, 100
				{
					;this.useratorActivate()
					sleep 50
					MouseClick, left, 1295, 10, 1, 3
					sleep 50
					WinGetActiveStats, title, width, height, x, y
					if (height=768) {
						;nqma userator
						goto, UseratorSCreenCatcherNotOkss
					} else {
						;ima userator
						goto, VsichkoEOKExitss
					}
					UseratorSCreenCatcherNotOkss:
					sleep 100
				}
				sleep 1
			}
			VsichkoEOKExitss:
			sleep 100
			this.UseratorErrornew()
			sleep 50
			return
		}
	;screenshot pages
		useratorSiteShotsSinon() {
			this.browserTabAction("Firefox", "change", 4)
			this.FFwaitAll()
			this.useratorActivate()
			this.useratorScreenPlusErrors()
			;proverka dali ima oshte 1 sluchaen sait
			this.useratorActivate()
			MouseClick, left, 1222, 21, 1, 3
			sleep 50
			WinGetActiveStats, title, width, height, x, y
			xListBox1:=Acc_Geth("Location", this.uListbox, 0, "ahk_class UseratorGUI")
			;340 e stapkata s kasiqt broi stranici
			if (height=xListBox1) {
				;ima 2-ri sait
				;********************* Zatvarqne na tab 3 i izbirane na tab 2 *******************************
				;izbira se poslednit tab i se zatvarq
				this.browserTabAction("Firefox", "close", 4)
				this.browserTabAction("Firefox", "change", 3)
				this.FFwaitAll()
				this.useratorExistnew()
				this.useratorErrornew()
				this.useratorScreenshot()
			}
			this.browserTabAction("Firefox", "close", 3)
			sleep 200
			return
		}
	;position of the target site in userator
		useratorPosition() {
			poziciqvuser := this.targetPageInfo[2]
			xListBoxRaw:=Acc_GetX("Location", this.uListbox, 0, "ahk_class UseratorGUI")
			yListBoxRaw:=Acc_GetY("Location", this.uListbox, 0, "ahk_class UseratorGUI")
			this.useratorActivate()
			this.OffsetLMouseClick(xListBoxRaw, yListBoxRaw, 55, 16, "left") 
			sleep 200
			this.Hom()
			if (poziciqvuser != 1) {
				poziciqsaitcorr := poziciqvuser-1
				SetKeyDelay, 300, 10
				send {Down %poziciqsaitcorr%}
				sleep 100
			}
			sleep 200
			return
		}
		useratorPositionEnd(){
			;aktivira se userator
			this.useratorActivate()
			Mousemove, 1208, 15, 2
			sleep 200
			mouseclick, left
			sleep 200
			;izprashta se enter
			Loop
			{
				sleep 10
				run, "Z:\SPODELEN\UCB\lib\AutoIT\mleft_click.au3"
				sleep 100
				this.UseratorExistnew()
				this.UseratorErrornew()
				this.useratorActivate()
				UserOtpravitH := Acc_Geth("Location", this.uListbox, 0, "ahk_class UseratorGUI")
				if (UserOtpravitH>300) {
					sleep 10
					continue
				} else {
					break
				}
			}
			sleep 200
			this.useratorActivate()
			this.UseratorExistnew()
			this.UseratorErrornew()
			;proverka dali ima msgbox, che ne sme izbrali poziciq
			IfWinExist, Не выбран вариант
			{
				this.messagebox("Postavqne na poziciqta, Skrinshot i OK")
				sleep 200
				goto, startclicksite
			}
			;natiska se enter za ok i za snimka
			sleep 300
			this.useratorScreenshot()
			startclicksite:
			;izbira se firefox tab 1
			this.browserWinAction("Firefox", "activate")
			this.Cr9()
			;klika se varhu 1-viqt tab
			Run, Z:\SPODELEN\Neshta\Autohotkey Scripts\Auto_firefox\Yostrov2015\razhodka.ahk
			;Run, Z:\SPODELEN\UCB\lib\razhodka.ahk
			ExitApp
			return
		}
		useratorScrollTargetPagePosition(searchEngine, searchwww, message="No", clickButton="left") {
			if (this.notInTop.maxIndex()!="") {
				this.useratorTargetPageNotInTop(searchEngine, searchwww, clickButton)
				ExitApp
			}
			WorkSitePath := this.targetPageInfo[1]
			this.FFOnScreenLocation(WorkSitePath, searchEngine, clickButton)
			this.browserTabAction("Firefox", "change", 2)
			if (message = "Yes") {
				this.messagebox("Postavqne na poziciqta")
			} else if (message="NiT") {
				this.useratorActivate()
				this.useratorScreenshot()
				this.browserWinAction("Firefox", "activate")
				this.Cr9()
				Run, Z:\SPODELEN\Neshta\Autohotkey Scripts\Auto_firefox\Yostrov2015\razhodka.ahk
				ExitApp
			} else {
				this.useratorPosition()
			}
			this.useratorPositionEnd()
			return
		}
		;izpalnqva se kogato stranicata ne e v top 50
		useratorTargetPageNotInTop(searchEngine, searchwww, clickButton) {
			this.targetPageInfo := Array()
			this.notInTop		:= Array()
			this.useratorNoTop50Combine()
			this.browserTabAction("Firefox", "change", 2)
			this.Hom()
			neVTopSearchWords := this.FFnevTop50PromqnaKeyword(searchwww)
			if (searchEngine = "google") {
				this.GoogleSearchBarLoc()
				this.FFSeLoad(neVTopSearchWords, "includeE", "same")
				this.googleavcheck()
				mainObj := this.FFMainObject()
				this.googleWrongSearchClick(mainObj)
			} else {
				this.yandexSBLocator()
				this.FFSeLoad(neVTopSearchWords, "includeE", "same")
				this.yandexRemoveBrowserDownloadLink()
			}
			this.useratorFindTargetPage(searchwww, "Yes", searchEngine)
			if (this.notInTop.maxIndex()!="") {
				this.useratorNeVTop50End()
				ExitApp
			} else {
				this.useratorScrollTargetPagePosition(searchEngine, searchwww, "NiT", clickButton)
			}
			
			return
		}
	;marking in userator that the site is not in top50
		useratorNoTop50Combine() {
			this.useratorActivate()
			xListBoxRaw:=Acc_GetX("Location", this.uListbox, 0, "ahk_class UseratorGUI")
			yListBoxRaw:=Acc_GetY("Location", this.uListbox, 0, "ahk_class UseratorGUI")
			this.OffsetLMouseClick(xListBoxRaw, yListBoxRaw, 55, 16) 
			sleep 400
			mouseclick, left
			sleep 400
			mouseclick, left
			sleep 200
			this.En()
			sleep 200
			;Natiskane na Ok buttona na userator
			run, "Z:\SPODELEN\UCB\lib\AutoIT\enter.au3"
			sleep 500
			this.useratorExistnew()
			this.useratorErrornew()
			sleep 200
			return
		}
		useratorNeVTop50End(){
			;saita ne e v top50 i s url
			this.messagebox("Ne e v top50 site")
			sleep 200
			;ZA PREMAHVANE SLED KATO SE PREMINE NA NOVA VERSIQ NA RAZHODKA
					sleep 200
					;saita ne e v top 50
					FileDelete, C:\Neshta\Autohotkey Scripts\Auto_firefox\Vzadache_text\nevtop50.txt
					FileAppend,
						(
							Sayt ne nakhoditsya v top 50
						), C:\Neshta\Autohotkey Scripts\Auto_firefox\Vzadache_text\nevtop50.txt
					sleep 100
			;ZA PREMAHVANE SLED KATO SE PREMINE NA NOVA VERSIQ NA RAZHODKA
			;saita ne e v top 50
			this.useratorActivate()
			this.useratorScreenPlusErrors()
			;load-va ot starata versiq
			;Run, Z:\SPODELEN\UCB\lib\razhodka.ahk
			Run, Z:\SPODELEN\Neshta\Autohotkey Scripts\Auto_firefox\Yostrov2015\nevtopasites.ahk
			ExitApp
		}
	;natiskane na otpravit i postavqne na komentar
		useratorCommEnd() {
			;postavqne na komentara v poleto za komentar na userator
			replace:= {"file1":"commtext.txt","file2":"nqmalink.txt","file3":"nezarejda.txt","file4":"nevtop50.txt"}
			for what, with in replace {
				FileRead, readvalue, C:\Neshta\Autohotkey Scripts\Auto_firefox\Vzadache_text\%with%
				;FileRead, readvalue, C:\UCB\Temp\%with%
				if (readvalue!="") {
					this.messagebox(readvalue)
				}
			}
			sleep 200
			return
		}
	;krai na zadanie
		useratorEndTask() {
			Loop {
				this.useratorActivate() 
				WinGetActiveStats, title, width, height, x, y
				sleep 50
				targetW=523
				targetH=189
				if (height=targetH) and (width=targetW) {
					goto, exitendloop
				}
				sleep 500
			}
			exitendloop:
			sleep 200
			return
		}
	; userator ctrl + 1
	;izprashta ctrl+1 v userator i pravi proverki
		useratorctrl1otpravit() {
			;vzimat se razmerite na userator predi da se prati ctrl+1
			WinGetActiveStats, title, width, height, x, y
			widthstart:=width
			heightstart:=height	
			Loop {
				;izprashta se ctrl+1 za sledvashtata stapka
				this.useratorActivate()
				this.useratorCtrl1()
				;podcikal za opredelqne dali se e otvoril userator i dali razmerite savpadat
				Loop {
					WinGetActiveStats, title, width, height, x, y
					widthend:=width
					heightend:=height
					;proverka dali razmerite savpadat s tezi ot predishnata stapka
					if (widthstart=widthend) and (heightstart=heightend) {
						;sravnqvanite razmeri sa ednakvi => nqmame promqna
						;msgbox, ednakvi
						goto, Ctrl1UseratorChecknachalo24
					} else {
						;sravnqvanite razmeri sa razlichni => ima promqna
						;msgbox, izliza se ot loopa
						goto, exitloopctrl1useratorcheck24
					}
					sleep 50
				}		
				Ctrl1UseratorChecknachalo24:
				sleep 3000
			}
			exitloopctrl1useratorcheck24:
			sleep 100
			return
		}
	;krai na nppy ili na nppg
		useratorEndNPPX() {
			this.browserTabAction("Firefox", "change", 3)
			this.FFwaitAll()
			this.useratorActivate() 
			;klika se varhu ok butona userator
			this.useratorCtrl1()
			this.useratorScreenPlusErrors()
			this.useratorCommEnd()
			;izprashta se otpravit za sledvashtata stapka
			this.browserTabAction("Firefox", "close", 2)
			this.useratorActivate() 
			this.useratorErrornew()
			this.useratorActivate() 
			sleep 100
			Loop
			{
				sleep 10
				Mousemove, 1308, 315, 2
				sleep 400
				Loop, 2
				{
					run, "Z:\SPODELEN\UCB\lib\AutoIT\mleft_click.au3"
				}
				sleep 100
				Loop, 2
				{
					run, "Z:\SPODELEN\UCB\lib\AutoIT\mleft_click.au3"
				}
				sleep 100
				this.useratorExistnew()
				this.useratorErrornew()
				sleep 100
				usernow:=Acc_GetH("Location", this.uListbox, 0, "ahk_class UseratorGUI")
					if (usernow!=189)
					{
						goto, otpravitotnachalo11
					}
					else
					{
						goto, otpravitok11
					}
				sleep 6000
				otpravitotnachalo11:
			}
			otpravitok11:
			sleep 200
			this.useratorActivate() 
			this.useratorEndTask()
			sleep 200
			this.useratorctrl1otpravit()
			sleep 300
			Run, Z:\SPODELEN\UCB\vstart.ahk
			sleep 200
		}
	;mousemoves for razhodka
		useratorCtrl1MouseMove(currenterror, scrollNow="Yes") {
			WinGetPos, x, y, width, height, ahk_class UseratorGUI
			widthstart:=width
			heightstart:=height	
			Loop {
				this.useratorActivate()
				this.useratorCtrl1() 
				;podcikal za opredelqne dali se e otvoril userator i dali razmerite savpadat
				Loop {
					this.UseratorExistnew()
					this.UseratorErrornew()
					WinGetPos, x, y, width, height, ahk_class UseratorGUI
					widthend:=width
					heightend:=height
					if (widthstart=widthend) and (heightstart=heightend) {
						;sravnqvanite razmeri sa ednakvi => nqmame promqna
						goto, randomScrollOrNot
					} else {
						;sravnqvanite razmeri sa razlichni => ima promqna
						goto, exitUseratorCMM
					}
					sleep 50
				}
				randomScrollOrNot:
				if (scrollNow = "Yes") {
					this.FFRandomScroll(currenterror)
				}
				sleep 1
			}
			exitUseratorCMM:
			sleep 200
			return
		}
		;otvarqne na dopalnitelnite scriptove i programi
		useratorExtraProgOpener()
		{
			Run, "C:\Program Files\ABBYY FineReader 11\Bonus.ScreenshotReader.exe"
			sleep 200
			WinWait , ABBYY Screenshot Reader
			sleep 3000
			WinActivate, ABBYY Screenshot Reader
			sleep 200
			changeAbbyySendMode()
			sleep 5000
			this.AbbyyCloser()
			sleep 300

			Run, Z:\SPODELEN\UCB\numpadmap.ahk
			sleep 100
			this.messagebox("Click to start loading TASKS!!!!!!!")
			this.UseratorNovoZadanie()
			sleep 100
			Run, Z:\SPODELEN\UCB\vstart.ahk
			
			return
		}
		;make array of search results without pages that must not be opened
		useratorBezSluchainiStranici(taskType="non", searchEngine="yandex", clickButton="left") {
			NesluchainiStranici	:= array()
			cyrcheck	= xn~p
			spacer		= bqdyiy
			removethis =Если в задан
			searchdot=.
			removeOK:=["I ок 1]","I ок 1"]
			removeDoNotOpen = Не открывайте сайт
			removeDoNotOpenSyn = Не открывайте сайты как случайные:
			abbyyfile:="W:\zad.txt"

			;Screenshot na sluchainite saitove koito ne trqbva da se otvarqt
			this.browserMinMaxAction("Firefox", "min")
			abbyfast() 
			this.browserMinMaxAction("Firefox", "max")
			FileRead, nesluchaen, %abbyyfile%			
			for each, site in this.ExcludeSites {
			StringCaseSense, Locale
		;msgbox, %site%< i >%nesluchaen%<
				IfInString, nesluchaen, %site%
				{
					if (taskType = "non") {
						this.messagebox("Rachno otvarqne na saita , OK !!!")
						sleep 400
						this.useratorEndNPPX()
						ExitApp
					} else {
						this.messagebox("Rachno otvarqne na saita , OK !!!")
						sleep 400
						this.useratorSynonEnder(searchEngine, clickbutton)
						;Run, Z:\SPODELEN\UCB\vstart.ahk
						ExitApp
					}
					
				}
			}
			StringCaseSense, Locale
			IfInString, nesluchaen, %removethis%
			{	 
				StringGetPos, removePos, nesluchaen, %removethis%
				StringLeft, nesluchaen, nesluchaen, % (removePos-2)
				StringGetPos, removeDoNotOpenPos, nesluchaen, %removeDoNotOpen%
				StringtrimLeft, nesluchaen, nesluchaen, % (removeDoNotOpenPos + StrLen(removeDoNotOpen)+1)
				StringCaseSense, Locale
				IfNotInString, nesluchaen, %searchdot%
				{
					this.messagebox("Nqma sait koito netrqbva da se otvarq")
					sleep 400
					Run, Z:\SPODELEN\UCB\vstart.ahk
					ExitApp
				}
			} else {
				;premahva izlishniqt tekst predi saitovete, kogato ima synonim
			;msgbox, nesluchaen no enters %nesluchaen%
				StringGetPos, removeDoNotOpenPos, nesluchaen, %removeDoNotOpenSyn%
				StringtrimLeft, nesluchaen, nesluchaen, % (removeDoNotOpenPos+StrLen(removeDoNotOpenSyn)+2)
				for each, occur in removeOK {
					;msgbox, %occur% i nesluch %nesluchaen%
					StringGetPos, occurPos, nesluchaen,  %occur%
					if (occurPos>-1) {
						StringLeft, nesluchaen, nesluchaen, occurPos
					}
				}
				
				nesluchaen=%nesluchaen%
			;msgbox, nesluchaen trim >%nesluchaen%<
			}
			RawSites:=nesluchaen
		;msgbox, %rawsites% rawsites
			If InStr( RawSites, cyrcheck){
				;saita e na kirilica
				NesluchainiStranici.Insert(".рф")
			}
			;zamenqne na vsichki web atributi s predefiniran speisar
			for key, value in this.UrlAttrib {
				StringReplace, RawSites, RawSites, %key%, %value%, All
			}
			;Loop za premahvane na speisara i postavqne na vseki otdelen sait v array-a	
			Loop {
				;Proverka dali ima speisar
				If InStr( RawSites, spacer) {
					;vzima se poziciqta na speisara
					StringGetPos, SpacerPos, RawSites, %spacer%
					;Ako poziciqta e > ot 0 to speisara e sled saita
					if (Spacerpos<3) {
						;remove spacer
						Stringtrimleft, RawSites, RawSites, % (SpacerPos+StrLen(spacer))
						continue
					} else {
						;otrqzva se url na saita do sledvastiqt sprisar
						StringLeft, SiteOnly, RawSites, % SpacerPos
						;postavq se otrqzaniqt url v array-a
						ClearSite:=RemoveExtraChars(SiteOnly)
					;msgbox, clearSite to insert >%ClearSite%<
						NesluchainiStranici.Insert(ClearSite)
						;premahva se url na otrqzaniqt sait ot osnovniqt tekst
						StringTrimLeft, RawSites, RawSites, % SpacerPos
						continue
					}
				}
				;proverka dali RawSites e empty
				if (RawSites="") {
					;ako e empty se izliza ot loop-a
					break
				} else {
					;ako ne e empty se postavq clipborda v array-a i se izliza
					ClearSite2:=RemoveExtraChars(RawSites)
				;msgbox, ClearSite2 to insert >%ClearSite2%<
					NesluchainiStranici.Insert(ClearSite2)
					break
				}
				sleep 1
			}
			sleep 200
			return, NesluchainiStranici
		}
		useratorSynonEnder(searchEngine="yandex", clickbutton="left") {
			this.useratorSiteShotsSinon()
			searchwww		:= this.FFUrlSearchResult()
		;msgbox, searchwww >%searchwww%<
			this.browserTabAction("Firefox", "change", 2)
			this.useratorFindTargetPage(searchwww, "Yes", searchEngine)
			if (searchEngine = "yandex") {
				this.useratorScrollTargetPagePosition(searchEngine, searchwww, "No", clickButton)
				this.yandexTargetPageNotInTop(searchwww)
				ExitApp
			} else {
				this.useratorScrollTargetPagePosition(searchEngine, searchwww, "Yse")
				this.googleTargetPageNotInTop(searchwww)
				ExitApp
			}
			return
		}
		/*
		useratorExcludeTasks(searchWords){
			for each, exclude in this.ExcludeTasks {
			StringCaseSense, Locale
		;msgbox, %exclude%< i >%searchWords%<
				IfInString, searchWords, %exclude%
				{
					sleep 1000
					this.UseratorNovoZadanie()
					sleep 104237
					Run, Z:\SPODELEN\UCB\vstart.ahk
					ExitApp
					
				}
				sleep 1
			}
			return
		}
		*/
		;proverka dali tarsenata stranica e mejdu rezultatite targetPage=Yes da promeni funkciqta da tarsi samo celevata stranica
		useratorFindTargetPage(pageToFind, targetPage, searchEngine) {
			page 		:= 0
			realPosition	:= 0
			
			loop, 5 
			{
				if (searchEngine = "google") {
					this.posi:=0
					this.googBaseAll(pageToFind, targetPage)
				} else if (searchEngine = "yandex") {
					this.yandexRemoveBrowserDownloadLink()
					this.yandexResults(pageToFind, targetPage)
				} else {
					this.messagebox("Nepoznat SE !!!!!")
					ExitApp
				}
				if ((this.targetPageInfo[1] != "") and (this.targetPageInfo[1] != "Ne e Path")) {
					realPos := A_index * 10 - 10 + this.targetPageInfo[2]
					;msgbox, realpos %realPos%
					this.targetPageInfo.Remove(2)
					this.targetPageInfo.Insert(realPos)
					goto endpageinfo
				}
				;msgbox, a index %A_Index%
				if (A_index = 5) {
					break
				} else {
					beforeUrl := this.FFGetCurrUrl()
					this.FFChangeCrAlZ()
					afterUrl := this.FFGetCurrUrl()
					if (beforeUrl = afterUrl) {
						break
					}
				}
			}
			if (this.targetPageInfo.MaxIndex() = "") {
				this.notInTop.Insert(1)
			}
			endpageinfo:
			return
		}
		
		useratorVzadOpener(vmname, vmpass)
		{
			signinloc:="application.grouping1.property_page1.unknown_object1.document1.unknown_object1.unknown_object1.unknown_object2"
			userpassloc:="application.grouping1.property_page1.unknown_object1.document1.dialog.unknown_object1.unknown_object1"
			OffsetXUser:=67
			OffsetYUser:=81
			OffsetXPass:=76
			OffsetYPass:=139
			OffsetXSign:=158
			OffsetYSign:=195
			SigninXOffset:=104
			SigninYOffset:=40
			
			WinActivate, ahk_class MozillaWindowClass
			sleep 200	
			;WinMove, A,, 0, 0, 1023, 728
			;sleep 200
			;this.Cr1user()
			;sleep 100
			;this.CrL()
			;sleep 100
			;this.sendingKeys("vzadache.ru")
			;Ente()
			;sleep 100
			;this.FFwaitAll()
			;sleep 100
			;logvane v vzadache
			SigninX:= Acc_GetX("Location", signinloc, 0, "ahk_class MozillaWindowClass")
			SigninY:= Acc_GetY("Location", signinloc, 0, "ahk_class MozillaWindowClass")
			
			this.OffsetLMouseClick(SigninX, SigninY, SigninXOffset, SigninYOffset)
			this.FFwaitAll()
			sleep 100

			;postavqne na username i password
			UserPassX:= Acc_GetX("Location", userpassloc, 0, "ahk_class MozillaWindowClass")
			UserPassY:= Acc_GetY("Location", userpassloc, 0, "ahk_class MozillaWindowClass")
			if (UserPassX!="") && (UserPassY!="")
			{
				this.OffsetLMouseClick(UserPassX, UserPassY, OffsetXUser, OffsetYUser)
				this.CrA()
				this.sendingKeys(vmname)
				this.Ente()
				sleep 100
				this.OffsetLMouseClick(UserPassX, UserPassY, OffsetXPass, OffsetYPass)
				this.CrA()
				this.sendingKeys(vmpass)
				this.Ente()
				sleep 100
				this.OffsetLMouseClick(UserPassX, UserPassY, OffsetXSign, OffsetYSign)
				sleep 100
			}
			else
			{
				sleep 800
				exitApp
			}
			sleep 800
			return
		}

		
	}